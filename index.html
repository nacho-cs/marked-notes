<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="A way to take notes in markdown and have them appear properly."
    />
    <meta
      name="keywords"
      content="notetaking, notes, bootstrap, markdown, html, css, frontend, javascript"
    />
    <meta name="author" content="nacho-cs" />
    <title>• marked notes</title>

    <!-- make everything look pretty -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <!-- roboto mono, the font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@100;300;400;500;700;900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@500"
    />
    <!-- favicon -->
    <link
      href="./format_list_bulleted_FILL0_wght400_GRAD0_opsz48.png"
      rel="icon"
      style="border-radius: 50%"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown.min.css"
      integrity="sha512-Ya9H+OPj8NgcQk34nCrbehaA0atbzGdZCI2uCbqVRELgnlrh8vQ2INMnkadVMSniC54HChLIh5htabVuKJww8g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- no xss attacks ^^ -->
    <script
      defer
      src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.1/purify.min.js"
      integrity="sha512-TU4FJi5o+epsahLtM9OFRvH2gXmmlzGlysk9wtTFgbYbMvFzh3Cw1l3ubnYIvBiZCC/aurRHS408TeEbcuOoyQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/13.0.1/markdown-it.min.js"
      integrity="sha512-SYfDUYPg5xspsG6OOpXU366G8SZsdHOhqk/icdrYJ2E/WKZxPxze7d2HD3AyXpT7U22PZ5y74xRpqZ6A2bJ+kQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <!-- bootstrap, css framework -->
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
      crossorigin="anonymous"
    ></script>
    <!-- dom-to-image, converts html elements to images -->
    <script
      defer
      src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"
      integrity="sha512-01CJ9/g7e8cUmY0DFTMcUw/ikS799FHiOA0eyHsUWfOetgbx/t6oV4otQ5zXKQyIrQGTHSmRVPIgrgLcZi/WMA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
  </head>

  <body
    class="overflow-x-hidden"
    style="font-family: 'Roboto Mono', sans-serif; background-color: var(--bg)"
    onload="localStorage.getItem('text') ? URLtoInput() : '# type here'; parse()"
  >
    <!-- some basic styles -->
    <style>
      @media (prefers-color-scheme: light) {
        body {
          --bg: #fff;
          --text: #2f2924;
          --hover: #d3d3d3;
        }
      }

      @media (prefers-color-scheme: dark) {
        body {
          --bg: #0d1117;
          --text: #d9d1c9;
          --hover: #323232;
        }
      }

      .deco {
        background-color: var(--bg);
        border-radius: 50%;
      }

      .deco:hover {
        background-color: var(--hover);
      }

      img {
        width: 100%;
      }

      .alert,
      .navbar {
        user-select: none;
      }
    </style>
    <!-- the navbar at the top, manages everything -->
    <header
      class="navbar navbar-expand border-bottom shadow-sm user-select-none"
      style="font-family: 'Roboto', sans-serif"
    >
      <div class="container-fluid" style="width: 95%">
        <div class="navbar-brand">
          <a href="./" class="nav-link"
            ><h4 style="font-weight: 700; margin: auto; color: var(--text)">
              • marked notes
            </h4></a
          >
        </div>
        <ul
          class="navbar-nav flex justify-content-between"
          style="width: fit-content"
        >
          <li
            class="nav-item material-symbols-outlined nav-link deco"
            title="• minimize the input"
            onclick="hide()"
            style="color: var(--text)"
            id="collapse"
          >
            arrow_back_ios
          </li>
          <li
            class="nav-item material-symbols-outlined nav-link deco"
            title="• share your notes"
            onclick="copyLink()"
            style="color: var(--text)"
          >
            send
          </li>
          <li
            class="nav-item material-symbols-outlined nav-link deco"
            title="• copy your notes"
            onclick="copyNotes()"
            style="color: var(--text)"
          >
            content_copy
          </li>
          <li
            class="nav-item material-symbols-outlined nav-link deco"
            title="• export your notes"
            style="color: var(--text)"
            onclick="exportNotes()"
          >
            download
          </li>
        </ul>
      </div>
    </header>

    <!-- gives an alert to you if you copied the link -->
    <div
      class="alert alert-info alert-dismissible text-center shadow-sm visually-hidden"
      id="copy-link"
    >
      • copied link
      <button
        class="btn-close"
        onclick="document.querySelector('#copy-link').classList.add('visually-hidden')"
      ></button>
    </div>

    <!-- gives an alert to you if you copied your notes -->
    <div
      class="alert alert-info alert-dismissible text-center shadow-sm visually-hidden"
      id="copy-notes"
    >
      • copied notes
      <button
        class="btn-close"
        onclick="document.querySelector('#copy-notes').classList.add('visually-hidden')"
      ></button>
    </div>

    <!-- just shows an error message -->
    <div
      class="alert alert-warning alert-dismissible text-center shadow-sm visually-hidden"
      id="show-cors-error"
    >
      • failed to download image
      <button
        class="btn-close"
        onclick="document.querySelector('#show-cors-error').classList.add('visually-hidden')"
      ></button>
    </div>

    <!-- the main place where you write and see your notes -->
    <div class="container-fluid mt-2 h-75" style="width: 98%">
      <div class="row">
        <div class="col-6 text-center" id="input">
          <textarea
            class="shadow-sm border rounded w-100 p-2"
            style="
              outline: none;
              background-color: var(--bg);
              color: var(--text);
            "
            rows="15"
          ></textarea>
        </div>
        <div
          class="col-6 border rounded shadow-sm markdown-body"
          style="width: 49%; padding: 15px; height: fit-content"
          id="output"
        ></div>
      </div>
    </div>
    <br /><br /><br />

    <script>
      document.querySelector("textarea").addEventListener("input", () => {
        parse();
        addtoURL();
      });

      // convert from markdown code to HTML
      function parse() {
        document.querySelector("#output").innerHTML = DOMPurify.sanitize(
          window.markdownit().render(document.querySelector("textarea").value)
        );
        localStorage.setItem("text", document.querySelector("textarea").value);
        document.title = `${
          document.querySelector("#output").firstChild == null
            ? "• marked notes"
            : "• " + document.querySelector("#output").firstChild.innerText
        }`;
      }

      if (document.readyState == "loading") {
        document.addEventListener("DOMContentLoaded", URLtoInput);
      } else {
        URLtoInput();
      }

      // convert the url string to the input value
      function URLtoInput() {
        const url = new URL(window.location);
        const notes = new URLSearchParams(url.search).get("notes");
        document.querySelector("textarea").value = notes;
      }

      // add whatever is in the input to the url
      function addtoURL() {
        const url = new URL(window.location);
        const notes = document.querySelector("textarea").value;
        url.searchParams.set("notes", notes);
        window.history.pushState(null, null, url);
      }

      // add the option to export your notes as an image
      function exportNotes() {
        domtoimage
          .toPng(document.querySelector("#output"))
          .then((url) => {
            const link = document.createElement("a");
            link.href = url;
            link.download = `${document.title}.png`;
            link.click();
          })
          .catch((err) => {
            document
              .querySelector("#show-cors-error")
              .classList.remove("visually-hidden");
            console.log(err);
          });
      }

      // make the output take up 100% of the screen
      function hide() {
        document.querySelector("#input").classList.toggle("visually-hidden");
        document.querySelector("#output").classList.toggle("col-6");
        document.querySelector("#output").classList.toggle("col");
        document.querySelector("#collapse").innerText = document
          .querySelector("#collapse")
          .innerText.includes("back")
          ? "arrow_forward_ios"
          : "arrow_back_ios";
      }

      // copy the link to share notes
      function copyLink() {
        navigator.clipboard.writeText(window.location.href);
        document
          .querySelector("#copy-link")
          .classList.remove("visually-hidden");
      }

      // copy your notes
      function copyNotes() {
        navigator.clipboard.writeText(document.querySelector("#output").innerText);
        document
          .querySelector("#copy-notes")
          .classList.remove("visually-hidden");
      }
    </script>
  </body>
</html>
